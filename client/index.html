<html>
<head>

  <!--
  <link rel="stylesheet" href="styles.css">
  -->

  <style type="text/css">

    body, a {

    }

  </style>
</head>

<body ng-app="songApp">

<h2>songs</h2>


<div ui-view="main">

</div>


<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>

<script type="text/javascript">

  var SongApp = angular.module("songApp", ['ui.router']);

  SongApp.controller('MainCtrl', function ($scope, Songs, songs) {

    var newSong;

    var clearNewSong = function () {
      newSong = {
        name: '',
        url: ''
      };

      newSong =
      {name: 'dookie booty', length: 40, mixPosition: 0, url: 'https%3A//api.soundcloud.com/tracks/210507981'};
    };

    clearNewSong();

    Songs.songs = songs;


    $scope.clearNewSong = clearNewSong;
    $scope.newSong = newSong;
    $scope.Songs = Songs;

  });

  SongApp.service('Songs', function ($http) {


    Songs = {
      songs: [],
      loadSongs: function () {
        console.log('loading songs');
        return $http.get('/songs')
            .then(function (response) {
              Songs.songs = response.data;
              return Songs.songs;
            })
            .catch(function (error) {
              console.error(error);
            })
      },
      getSongs: function () {
        return Songs.songs;
      },
      add: function (song) {
        $http.post('/songs',song)
            .then( function(response){
              Songs.songs.push(response.data);
            })
            .catch( function(error){
              console.error(error);
            });
      }
    };

    return Songs;

  });

  SongApp.config(function ($stateProvider, $urlRouterProvider) {


    $stateProvider
        .state('home', {
          url: '/',
          views: {
            'main': {
              templateUrl: 'views/song.html',
              controller: 'MainCtrl',
              resolve:{
                songs: function(Songs){
                  console.log('songs resolve');
                  return Songs.loadSongs();
                }
              }
            }
          }
        });

    $urlRouterProvider.otherwise('/');


  })

</script>

</body>
</html>